<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LiftLab.Views.FriendsPage"
             xmlns:vm="clr-namespace:LiftLab.ViewModels"
             Title="FriendsPage">

    <ContentPage.BindingContext>
        <vm:FriendsViewModel />
    </ContentPage.BindingContext>

    <Grid Padding="10" RowDefinitions="Auto,Auto,Auto,Auto,Auto,*">

        <!-- Title -->
        <Label 
        Text="Find my Friends" 
        FontSize="24" 
        FontAttributes="Bold" 
        HorizontalOptions="Center" 
        Grid.Row="0" />

        <!-- Guidance text under title -->
        <Label 
        Text="Search and add people to start sharing your progress!" 
        FontSize="14" 
        TextColor="Gray" 
        HorizontalOptions="Center" 
        Grid.Row="1" 
        Margin="0,5,0,10" />

        <!-- SearchBar -->
        <SearchBar 
        Placeholder="Search friends..." 
        Text="{Binding SearchText}" 
        SearchCommand="{Binding SearchCommand}" 
        Grid.Row="2" />

        <!-- Label under searchbar -->
        <Label 
        Text="Results will appear below" 
        FontSize="12" 
        TextColor="Gray" 
        HorizontalOptions="Center" 
        Grid.Row="3"
        Margin="0,5,0,10" />

        <!-- Loading Indicator -->
        <ActivityIndicator 
        IsRunning="{Binding IsBusy}" 
        IsVisible="{Binding IsBusy}" 
        Grid.Row="4" 
        HorizontalOptions="Center" />

        <!-- Friend List with fixed height -->
        <CollectionView 
        ItemsSource="{Binding Users}" 
        VerticalOptions="Start"
        HeightRequest="300" 
            Grid.Row="5">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame CornerRadius="5" BorderColor="Green" Padding="15" Margin="5">
                        <Grid ColumnDefinitions="*,Auto">
                            <!-- Username -->
                            <Label 
                            Text="{Binding Username}" 
                            FontSize="16" 
                            FontAttributes="Bold" 
                            VerticalOptions="Center" 
                            Grid.Column="0" />

                            <!-- Add Friend Button -->
                            <Button 
                            Text="Add Friend" 
                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FriendsViewModel}}, Path=AddFriendCommand}" 
                            CommandParameter="{Binding UserId}" 
                            FontAttributes="Bold" 
                            BackgroundColor="Black" 
                            TextColor="White" 
                            Grid.Column="1" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>